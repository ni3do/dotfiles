# If available, source the system-wide zshrc
if [ -f /etc/zshrc ]; then
  . /etc/zshrc
fi

HISTSIZE="10000"
SAVEHIST="10000"
HISTFILE="$HOME/.zsh_history"

## Open buffer line in editor
autoload -Uz edit-command-line
zle -N edit-command-line
bindkey '^x^e' edit-command-line

# Expands history expressions like !! or !$ when you press space
bindkey ' ' magic-space

# Enable zmv
autoload -Uz zmv

# Usage examples:
# zmv '(*).log' '$1.txt'           # Rename .log to .txt
# zmv -w '*.log' '*.txt'           # Same thing, simpler syntax
# zmv -n '(*).log' '$1.txt'        # Dry run (preview changes)
# zmv -i '(*).log' '$1.txt'        # Interactive mode (confirm each)

# Copy current command buffer to clipboard (macOS)
function copy-buffer-to-clipboard() {
  echo -n "$BUFFER" | pbcopy
  zle -M "Copied to clipboard"
}
zle -N copy-buffer-to-clipboard
bindkey '^X^C' copy-buffer-to-clipboard


export EDITOR=nvim

# Starship
export STARSHIP_CONFIG=~/.config/starship/starship.toml

# FZF
export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow'
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Nvim
alias vi=nvim

# Claude Code
alias c="claude --dangerously-skip-permissions"
alias csafe=claude

# Eza
alias l="eza -l --icons --git -a"
alias lt="eza --tree --level=2 --long --icons --git"
alias ltree="eza --tree --level=2 --icons --git"

# bat
alias cat="bat --paging=never"
alias ocat="/bin/cat"

# Yazi wrapper
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}

bindkey -e

eval "$(starship init zsh)"
eval "$(zoxide init zsh)"

source ~/.config/antigen/antigen.zsh

# Keep antigen/zcache artifacts in XDG cache (not the repo root).
_antigen_cache_root="${XDG_CACHE_HOME:-$HOME/.cache}/antigen"
mkdir -p "$_antigen_cache_root"
export ANTIGEN_CACHE="$_antigen_cache_root/.antigen.zsh"
export ZCACHEFILE="$_antigen_cache_root/zcache.zsh"

antigen bundle git
antigen bundle zsh-users/zsh-syntax-highlighting
antigen bundle zsh-users/zsh-autosuggestions
antigen bundle "MichaelAquilina/zsh-you-should-use"
antigen bundle Aloxaf/fzf-tab

antigen apply

# Git overrides (after antigen to take precedence)
alias gc="git commit -m"

export PATH="$HOME/.local/bin:$PATH"
